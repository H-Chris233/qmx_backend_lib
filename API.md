# QMX Backend Library API æ–‡æ¡£ç´¢å¼•

## æ¦‚è¿°

QMX Backend Library æ˜¯ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„å­¦ç”Ÿç®¡ç†å’Œè´¢åŠ¡ç®¡ç†åº“ï¼Œæä¾›å®Œæ•´çš„å­¦ç”Ÿä¿¡æ¯ç®¡ç†ã€ç°é‡‘æµè®°å½•ã€åˆ†æœŸä»˜æ¬¾å¤„ç†å’Œç»Ÿè®¡åˆ†æåŠŸèƒ½ã€‚

**å½“å‰ç‰ˆæœ¬ï¼š** 2.4.0  
**æœ€åæ›´æ–°ï¼š** 2025-09-15

## ğŸ”” é‡è¦æ›´æ–° (v2.2.0)

**âš ï¸ æ³¨æ„ï¼š** v2.2.0åŒ…å«é‡è¦çš„APIè¡Œä¸ºå˜æ›´ï¼Œè¯·æŸ¥çœ‹ **[ğŸ“‹ å˜æ›´è¯´æ˜æ–‡æ¡£](API_CHANGES_v2.2.0.md)** äº†è§£è¯¦æƒ…ã€‚

**ä¸»è¦å˜æ›´ï¼š**
- `Student::set_class` æ–¹æ³•è¡Œä¸ºå˜æ›´ï¼ˆæ‹†åˆ†å‰¯ä½œç”¨ï¼‰
- `CashBuilder::build()` ç°åœ¨è¿”å› `Result<Cash>`
- æ–°å¢ç¯å¢ƒå˜é‡ `QMX_DATA_DIR` æ”¯æŒ
- å¢å¼ºçš„é”™è¯¯å¤„ç†å’Œæ•°æ®ä¸€è‡´æ€§

---

## ğŸ“š API ç‰ˆæœ¬é€‰æ‹©

### [ğŸ“– v1 API æ–‡æ¡£](API_v1.md)
**ä¼ ç»Ÿç›´æ¥æ“ä½œAPI** - é€‚åˆéœ€è¦ç²¾ç»†æ§åˆ¶çš„åœºæ™¯

- âœ… **ç¨³å®šå¯é ** - ç»è¿‡å……åˆ†æµ‹è¯•çš„æˆç†ŸAPI
- âœ… **ç›´æ¥æ“ä½œ** - ç›´æ¥æ“ä½œæ•°æ®ç»“æ„ï¼Œæ€§èƒ½æœ€ä¼˜
- âœ… **å®Œå…¨æ§åˆ¶** - å¯¹æ•°æ®åº“æ“ä½œæœ‰å®Œå…¨æ§åˆ¶æƒ
- âœ… **æ‰¹é‡æ“ä½œ** - å†…ç½®é«˜æ•ˆçš„æ‰¹é‡å¤„ç†æ–¹æ³•
- ğŸ¯ **é€‚ç”¨åœºæ™¯**ï¼šæ•°æ®è¿ç§»ã€æ‰¹é‡å¤„ç†ã€æ€§èƒ½æ•æ„Ÿåº”ç”¨

**æ ¸å¿ƒç»„ä»¶ï¼š**
- `Student` / `StudentDatabase` - å­¦ç”Ÿç®¡ç†
- `Cash` / `CashDatabase` - ç°é‡‘æµç®¡ç†
- `Database` - æ•°æ®åº“å®¹å™¨
- `DashboardStats` - ç»Ÿè®¡åˆ†æ
- é€šç”¨ `Database<T>` trait

### [ğŸš€ v2 API æ–‡æ¡£](API_v2.md)
**ç°ä»£åŒ–ç»Ÿä¸€API** - æ¨èç”¨äºæ–°é¡¹ç›®å¼€å‘

- ğŸš€ **ç°ä»£è®¾è®¡** - Builderã€Updaterã€Query Builderæ¨¡å¼
- ğŸ¯ **æ˜“äºä½¿ç”¨** - ç»Ÿä¸€çš„`QmxManager`å…¥å£
- ğŸ”’ **çº¿ç¨‹å®‰å…¨** - Arc<RwLock<T>>æ¶æ„
- ğŸ“Š **å¢å¼ºåˆ†æ** - ä¸°å¯Œçš„ç»Ÿè®¡å’ŒæŸ¥è¯¢åŠŸèƒ½
- ğŸ¯ **é€‚ç”¨åœºæ™¯**ï¼šæ–°é¡¹ç›®å¼€å‘ã€Webåº”ç”¨ã€å¤šçº¿ç¨‹ç¯å¢ƒ

**æ ¸å¿ƒç»„ä»¶ï¼š**
- `QmxManager` - ç»Ÿä¸€ç®¡ç†å…¥å£
- `StudentBuilder` / `StudentUpdater` / `StudentQuery` - å­¦ç”Ÿæ“ä½œ
- `CashBuilder` / `CashUpdater` / `CashQuery` - ç°é‡‘æ“ä½œ
- `StudentStats` / `FinancialStats` - å¢å¼ºç»Ÿè®¡

---

## ğŸ”„ ç‰ˆæœ¬å…¼å®¹æ€§

### å®Œå…¨å‘åå…¼å®¹
v2.2.0 **å®Œå…¨å…¼å®¹** v1 APIï¼Œç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹ï¼š

```rust
// v1 API ç»§ç»­å¯ç”¨
use qmx_backend_lib::*;

let mut db = init::init()?;
let mut student = Student::new();
student.set_name("å¼ ä¸‰".to_string());
db.student.insert(student);

// v2 API å¯åŒæ—¶ä½¿ç”¨
let manager = QmxManager::new(true)?;
let uid = manager.create_student(
    StudentBuilder::new("æå››", 18)
)?;
```

### æ¸è¿›å¼è¿ç§»
å¯ä»¥åœ¨åŒä¸€é¡¹ç›®ä¸­æ··ç”¨ä¸¤ä¸ªç‰ˆæœ¬çš„APIï¼Œé€æ­¥è¿ç§»ï¼š

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šç»§ç»­ä½¿ç”¨v1 APIï¼Œå¼•å…¥v2 APIç”¨äºæ–°åŠŸèƒ½
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šå°†éƒ¨åˆ†æ¨¡å—è¿ç§»åˆ°v2 API
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šå®Œå…¨è¿ç§»åˆ°v2 APIï¼ˆå¯é€‰ï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### é€‰æ‹©v1 APIï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰
```rust
use qmx_backend_lib::*;

fn main() -> anyhow::Result<()> {
    // åˆå§‹åŒ–æ•°æ®åº“
    let mut db = init::init()?;
    
    // åˆ›å»ºå­¦ç”Ÿ
    let mut student = Student::new();
    student.set_name("å¼ ä¸‰".to_string())
           .set_age(18);
    db.student.insert(student);
    
    // ä¿å­˜æ•°æ®
    save::save(db)?;
    Ok(())
}
```

### é€‰æ‹©v2 APIï¼ˆæ¨èï¼‰
```rust
use qmx_backend_lib::{QmxManager, StudentBuilder};

fn main() -> anyhow::Result<()> {
    // åˆå§‹åŒ–ç®¡ç†å™¨
    let manager = QmxManager::new(true)?;
    
    // åˆ›å»ºå­¦ç”Ÿï¼ˆè‡ªåŠ¨ä¿å­˜ï¼‰
    let uid = manager.create_student(
        StudentBuilder::new("å¼ ä¸‰", 18)
    )?;
    
    Ok(())
}
```

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | v1 API | v2 API | è¯´æ˜ |
|------|--------|--------|------|
| å­¦ç”Ÿç®¡ç† | âœ… ç›´æ¥æ“ä½œ | âœ… Builderæ¨¡å¼ | v2æ›´æ˜“ç”¨ |
| ç°é‡‘ç®¡ç† | âœ… ç›´æ¥æ“ä½œ | âœ… Builderæ¨¡å¼ | v2æ›´æ˜“ç”¨ |
| æ‰¹é‡æ“ä½œ | âœ… é«˜æ€§èƒ½ | âš ï¸ é€šè¿‡v1å®ç° | v1æ€§èƒ½æ›´ä¼˜ |
| æŸ¥è¯¢åŠŸèƒ½ | âš ï¸ æ‰‹åŠ¨éå† | âœ… Query Builder | v2æ›´å¼ºå¤§ |
| ç»Ÿè®¡åˆ†æ | âœ… åŸºç¡€ç»Ÿè®¡ | âœ… å¢å¼ºç»Ÿè®¡ | v2åŠŸèƒ½æ›´ä¸°å¯Œ |
| çº¿ç¨‹å®‰å…¨ | âŒ éœ€æ‰‹åŠ¨å¤„ç† | âœ… å†…ç½®æ”¯æŒ | v2æ›´å®‰å…¨ |
| é”™è¯¯å¤„ç† | âœ… anyhow::Result | âœ… anyhow::Result | ä¸¤è€…ç›¸åŒ |
| å­¦ä¹ æ›²çº¿ | ğŸ“ˆ ä¸­ç­‰ | ğŸ“‰ ç®€å• | v2æ›´å®¹æ˜“ä¸Šæ‰‹ |

---

## ğŸ¯ ä½¿ç”¨å»ºè®®

### æ¨èä½¿ç”¨ v2 API çš„åœºæ™¯ï¼š
- ğŸ†• **æ–°é¡¹ç›®å¼€å‘**
- ğŸŒ **Webåº”ç”¨å¼€å‘**
- ğŸ”„ **å¤šçº¿ç¨‹ç¯å¢ƒ**
- ğŸ‘¥ **å›¢é˜Ÿåä½œé¡¹ç›®**ï¼ˆAPIæ›´ç›´è§‚ï¼‰
- ğŸ“Š **éœ€è¦å¤æ‚æŸ¥è¯¢å’Œç»Ÿè®¡**

### æ¨èä½¿ç”¨ v1 API çš„åœºæ™¯ï¼š
- ğŸ”§ **ç°æœ‰é¡¹ç›®ç»´æŠ¤**
- âš¡ **æ€§èƒ½æ•æ„Ÿåº”ç”¨**
- ğŸ“¦ **å¤§æ‰¹é‡æ•°æ®å¤„ç†**
- ğŸ® **éœ€è¦ç²¾ç»†æ§åˆ¶**
- ğŸ”„ **æ•°æ®è¿ç§»å·¥å…·**

### æ··åˆä½¿ç”¨ç­–ç•¥ï¼š
```rust
use qmx_backend_lib::*;

fn hybrid_usage_example() -> anyhow::Result<()> {
    // ä½¿ç”¨v2è¿›è¡Œæ—¥å¸¸æ“ä½œ
    let manager = QmxManager::new(true)?;
    let uid = manager.create_student(
        StudentBuilder::new("æ–°å­¦å‘˜", 18)
    )?;
    
    // ä½¿ç”¨v1è¿›è¡Œæ‰¹é‡æ“ä½œ
    let mut db = init::init()?;
    let batch_students = vec![/* å¤§é‡å­¦ç”Ÿæ•°æ® */];
    db.student.insert_batch(batch_students);
    
    Ok(())
}
```

---

## ğŸ“– è¯¦ç»†æ–‡æ¡£é“¾æ¥

- **[ğŸ“˜ v1 API å®Œæ•´æ–‡æ¡£](API_v1.md)** - ä¼ ç»Ÿç›´æ¥æ“ä½œAPI
- **[ğŸ“— v2 API å®Œæ•´æ–‡æ¡£](API_v2.md)** - ç°ä»£åŒ–ç»Ÿä¸€API
- **[ğŸ“‹ v2.2.0 å˜æ›´è¯´æ˜](API_CHANGES_v2.2.0.md)** - é‡è¦å˜æ›´å’Œè¿ç§»æŒ‡å—

---

## ğŸ”§ å¼€å‘å·¥å…·

### ä¾èµ–é…ç½®
```toml
[dependencies]
qmx_backend_lib = "2.4.0"
anyhow = "1.0"
chrono = { version = "0.4", features = ["serde"] }
serde = { version = "1.0", features = ["derive"] }
```

### å¯¼å…¥å»ºè®®
```rust
// ä½¿ç”¨v1 API
use qmx_backend_lib::{*, student::*, cash::*};

// ä½¿ç”¨v2 API  
use qmx_backend_lib::{QmxManager, StudentBuilder, CashBuilder};

// æ··åˆä½¿ç”¨
use qmx_backend_lib::*;
```



*æ–‡æ¡£ç´¢å¼•ç‰ˆæœ¬ï¼š2.4.0*  
*æœ€åæ›´æ–°ï¼š2025-09-15*